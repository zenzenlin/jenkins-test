pipeline {
  agent any
  stages {
    stage ("Check www.example.com response code") {
      steps{
        sh '''
        # ... Stage æª¢æŸ¥é‚è¼¯èˆ‡ exit 1 ä¿æŒä¸è®Š ...
        response_code=$(curl -o /dev/null -s -w "%{http_code}" www.example.com)
        echo "www.example.com response code: ${response_code}"
        if [ "${response_code}" != "200" ]; then
          echo "éŒ¯èª¤ï¼šç¶²ç«™é€£ç·šæª¢æŸ¥å¤±æ•—ï¼Œç‹€æ…‹ç¢¼ç‚º ${response_code}ã€‚ä¸­æ­¢å»ºç½®ã€‚"
          exit 1 // è®“ Stage ç‹€æ…‹è®Šç‚º FAILED
        fi
        '''
      }
    }
  }
  post {
    // ğŸš¨ å¤±æ•—é€šçŸ¥ï¼šæ¢ä»¶
    failure {
      // æ­¥é©Ÿï¼šåœ¨ failure æ¢ä»¶æˆç«‹æ™‚ï¼Œè¼‰å…¥æ†‘è­‰
      withCredentials([string(credentialsId: 'email', variable: 'RECIPIENT')]) {
        emailext (
          subject: "[ğŸ”¥ FAILURE ALERT] ${env.JOB_NAME} - ç¶²ç«™é€£ç·šéŒ¯èª¤ï¼",
          body: "è«‹æª¢æŸ¥ Jenkins Build ç´€éŒ„ ${env.BUILD_URL} ä»¥ç²å–è©³ç´°è³‡è¨Šã€‚",
          to: RECIPIENT
        )
      }
    }
    // ğŸŸ¢ æˆåŠŸé€šçŸ¥ï¼šæ¢ä»¶
    success {
      // æ­¥é©Ÿï¼šåœ¨ success æ¢ä»¶æˆç«‹æ™‚ï¼Œè¼‰å…¥æ†‘è­‰
      withCredentials([string(credentialsId: 'email', variable: 'RECIPIENT')]) {
        emailext (
          subject: "[âœ… SUCCESS] ${env.JOB_NAME} - å®šæ™‚æª¢æŸ¥æˆåŠŸ",
          body: "é …ç›® ${env.JOB_NAME} ç¶²ç«™æª¢æŸ¥ (www.example.com) æˆåŠŸï¼Œç‹€æ…‹ç¢¼ç‚º 200ã€‚è©³æƒ…: ${env.BUILD_URL}",
          to: RECIPIENT
        )
      }
    }
  }
}
