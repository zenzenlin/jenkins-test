pipeline {
Â  agent any
Â  stages {
Â  Â  stage ("Check www.example.com response code") {
Â  Â  Â  steps{
Â  Â  Â  Â  sh '''
Â  Â  Â  Â  Â  # 1. å–å¾— HTTP ç‹€æ…‹ç¢¼
Â  Â  Â  Â  Â  response_code=$(curl -o /dev/null -s -w "%{http_code}" www.example.com)

Â  Â  Â  Â  Â  echo "www.example.com response code: ${response_code}"

Â  Â  Â  Â  Â  # 2. å¦‚æœç‹€æ…‹ç¢¼ä¸æ˜¯ 200ï¼Œå‰‡ä»¥éé›¶ä»£ç¢¼çµæŸ (exit 1)
Â  Â  Â  Â  Â  if [ "${response_code}" != "200" ]; then
Â  Â  Â  Â  Â  Â  echo "éŒ¯èª¤ï¼šç¶²ç«™é€£ç·šæª¢æŸ¥å¤±æ•—ï¼Œç‹€æ…‹ç¢¼ç‚º ${response_code}ã€‚ä¸­æ­¢å»ºç½®ã€‚"
Â  Â  Â  Â  Â  Â  exit 1 // è®“ Stage ç‹€æ…‹è®Šç‚º FAILED
Â  Â  Â  Â  Â  fi
Â  Â  Â  Â  '''
Â  Â  Â  }
Â  Â  }
Â  }Â  
Â  // ä½¿ç”¨ withCredentials éš±è—æ”¶ä»¶äºº Email
Â  post {
    // ä½¿ç”¨ withCredentials å¼•ç”¨ Secret textï¼Œä¸¦å°‡å…¶è³¦å€¼çµ¦è®Šæ•¸ RECIPIENT
    withCredentials([string(credentialsId: 'email', variable: 'RECIPIENT')]) {
      // ğŸš¨ å¤±æ•—é€šçŸ¥
      failure {
        emailext (
          subject: "[ğŸ”¥ FAILURE ALERT] ${env.JOB_NAME} - ç¶²ç«™é€£ç·šéŒ¯èª¤ï¼",
          body: "...", // å…§å®¹ä¿æŒä¸è®Šæˆ–è‡ªè¡Œèª¿æ•´
          to: "${RECIPIENT}" // ğŸŒŸ ä½¿ç”¨è®Šæ•¸ï¼Œè…³æœ¬ä¸Šå‚³ GitHub æ™‚å°‡æ˜¯å®‰å…¨çš„
        )
      }
      // ğŸŸ¢ æˆåŠŸé€šçŸ¥
      success {
        emailext (
          subject: "[âœ… SUCCESS] ${env.JOB_NAME} - å®šæ™‚æª¢æŸ¥æˆåŠŸ",
          body: "é …ç›® ${env.JOB_NAME} ç¶²ç«™æª¢æŸ¥ (www.example.com) æˆåŠŸï¼Œç‹€æ…‹ç¢¼ç‚º 200ã€‚",
          to: "${RECIPIENT}"
        )
      }
    }
Â  }
}
