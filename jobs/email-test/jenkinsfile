pipeline {
Â  agent any
Â  stages {
Â  Â  stage ("Check www.example.com response code") {
Â  Â  Â  steps{
Â  Â  Â  Â  sh '''
Â  Â  Â  Â  Â  # ... Stage æª¢æŸ¥é‚è¼¯èˆ‡ exit 1 ä¿æŒä¸è®Š ...
Â  Â  Â  Â  Â  response_code=$(curl -o /dev/null -s -w "%{http_code}" www.example.com)
Â  Â  Â  Â  Â  echo "www.example.com response code: ${response_code}"
Â  Â  Â  Â  Â  if [ "${response_code}" != "200" ]; then
Â  Â  Â  Â  Â  Â  echo "éŒ¯èª¤ï¼šç¶²ç«™é€£ç·šæª¢æŸ¥å¤±æ•—ï¼Œç‹€æ…‹ç¢¼ç‚º ${response_code}ã€‚ä¸­æ­¢å»ºç½®ã€‚"
Â  Â  Â  Â  Â  Â  exit 1 // è®“ Stage ç‹€æ…‹è®Šç‚º FAILED
Â  Â  Â  Â  Â  fi
Â  Â  Â  Â  '''
Â  Â  Â  }
Â  Â  }
Â  }Â Â 
Â  
Â  post {
Â  Â  // ğŸš¨ å¤±æ•—é€šçŸ¥ï¼šæ¢ä»¶
Â  Â  failure {
Â  Â  Â  // æ­¥é©Ÿï¼šåœ¨ failure æ¢ä»¶æˆç«‹æ™‚ï¼Œè¼‰å…¥æ†‘è­‰
Â  Â  Â  withCredentials([string(credentialsId: 'email', variable: 'RECIPIENT')]) {
Â  Â  Â  Â  emailext (
Â  Â  Â  Â  Â  subject: "[ğŸ”¥ FAILURE ALERT] ${env.JOB_NAME} - ç¶²ç«™é€£ç·šéŒ¯èª¤ï¼",
Â  Â  Â  Â  Â  body: "è«‹æª¢æŸ¥ Jenkins Build ç´€éŒ„ ${env.BUILD_URL} ä»¥ç²å–è©³ç´°è³‡è¨Šã€‚",
Â  Â  Â  Â  Â  to: "${RECIPIENT}" 
Â  Â  Â  Â  )
Â  Â  Â  }
Â  Â  }
Â  Â  // ğŸŸ¢ æˆåŠŸé€šçŸ¥ï¼šæ¢ä»¶
Â  Â  success {
Â  Â  Â  // æ­¥é©Ÿï¼šåœ¨ success æ¢ä»¶æˆç«‹æ™‚ï¼Œè¼‰å…¥æ†‘è­‰
Â  Â  Â  withCredentials([string(credentialsId: 'email', variable: 'RECIPIENT')]) {
Â  Â  Â  Â  emailext (
Â  Â  Â  Â  Â  subject: "[âœ… SUCCESS] ${env.JOB_NAME} - å®šæ™‚æª¢æŸ¥æˆåŠŸ",
Â  Â  Â  Â  Â  body: "é …ç›® ${env.JOB_NAME} ç¶²ç«™æª¢æŸ¥ (www.example.com) æˆåŠŸï¼Œç‹€æ…‹ç¢¼ç‚º 200ã€‚è©³æƒ…: ${env.BUILD_URL}",
Â  Â  Â  Â  Â  to: "${RECIPIENT}"
Â  Â  Â  Â  )
Â  Â  Â  }
Â  Â  }
Â  }
}
